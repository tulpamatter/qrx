<!DOCTYPE html><title>QRx 1.0</title><style>:root{color-scheme:light dark}</style><main></main><script>(async()=>{let $L=location,$P=$L.pathname.slice(1).replace(/^\/|\/$/g,""),$H=$L.hash.slice(1).replace(/^\/|\/$/g,"");if(!$P||!$H)return void $L.replace(`/${$P||"home"}#${$H||"home"}`);let d=document,b=d.querySelector("main"),g=e=>localStorage.getItem(e),D={},N=$P,GDB=e=>(D[e]||(D[e]=new Promise(t=>{let a=indexedDB.open(e,1);a.onupgradeneeded=e=>{let t=e.target.result;t.createObjectStore("f",{keyPath:"k"}),t.createObjectStore("h",{autoIncrement:!0})},a.onsuccess=e=>t(e.target.result)})),D[e]),db=await GDB(N),o=(e,t,a,...s)=>new Promise(n=>{e.transaction(t,"readwrite").objectStore(t)[a](...s).onsuccess=e=>n(e.target.result)}),$r=async(e,t=N)=>{let a=await GDB(t);return o(a,"f","get",e).then(e=>e?.value||"")},$rf=(e,t,a=N)=>new Promise(async s=>{let n=[];(await GDB(a)).transaction("f").objectStore("f").openCursor(IDBKeyRange.bound(e,e+"ï¿¿")).onsuccess=e=>{let a=e.target.result;a?(n.push(t?`<context source="${a.key}">${a.value.value}</context>`:a.value.value),a.continue()):s(n)}}),run=async()=>{await o(db,"h","add",{t:new Date,u:$L.href});let u=$L.hash.slice(1).replace(/^\/|\/$/g,""),[$c,$cmd]=u.split("?"),$p=$c||"home",GB=await $r("boot"),$s=await $r($p),$a=GB+$s;if($cmd){let S={m:g("m")||"gemini-2.5-flash",k:g("k"),s:"",t:$p},cmds=$cmd.split("&");for(let cmd of cmds){let[K,...V]=cmd.split("="),v=decodeURIComponent(V.join("="));if("hmk".includes(K))S[K]=v;else if("s"===K)S.s=v;else if("t"===K)S.t=v||$p;else if("w"===K)$s=v,$a=v,await o(db,"f","put",{k:S.t,value:$s});else if("b"===K||"s"===K){let[e,t]=S.s.includes("#")?S.s.split("#"):[N,S.s],a=t.endsWith("*"),s=a?t.slice(0,-1):t;if("b"===K){[e,t]=v.includes("#")?v.split("#"):[N,v],a=t.endsWith("*"),s=a?t.slice(0,-1):t;let n=a?await $rf(s,!1,e):[await $r(s,e)];$a=n.join("\n")+$a}if("s"===K){let t=a?await $rf(s,!1,e):[await $r(s,e)];S.s=t.join("\n")}}else if("x"===K)eval(v);else if("p"===K){let e=$a,t=S.s,a=v,s=v.match(/@(?:[\w-]+#)?[\w\/-]+\*?/g)||[];for(let e of s){let t=e.slice(1),[s,n]=t.includes("#")?t.split("#"):[N,t],i=n.endsWith("*"),r=i?n.slice(0,-1):n,l=i?await $rf(r,!0,s):[await $r(r,s)];a=a.replace(e,l.join("\n"))}let n={contents:[{parts:[{text:`<sys>${t}</sys><url>${$L.href}</url><doc>${e}</doc>${a}`}]}]},i=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${S.m}:generateContent?key=${S.k}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await i.json(),l=r.candidates[0].content.parts[0].text;if(!i.ok)throw r.error;$s=$a=l,await o(db,"f","put",{k:S.t,value:$s})}}history.replaceState(null,"",`/${N}#${$p}`)}b.innerHTML=$a,b.querySelectorAll("script").forEach(e=>{let t=d.createElement("script");for(let a of e.attributes)t.setAttribute(a.name,a.value);t.textContent=e.textContent,e.replaceWith(t)})};window.addEventListener("hashchange",run),run()})()</script>